<!DOCTYPE html>
<html>
  <head>
    <title>D√©tail du projet</title>
    <style>
html, body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  font-family: 'Inter', Arial, sans-serif;
  background: linear-gradient(140deg,#fafdff 0%,#f7faff 100%);
  color: #181c2f;
  overflow-x: hidden;
  position: relative;
}

/* Halo lumineux subtil */
body::before {
  content: '';
  position: fixed;
  left: 50%;
  top: 10%;
  width: 120vw;
  max-width: 500px;
  height: 220px;
  transform: translate(-50%, -10%);
  background: radial-gradient(circle, #e3e8ee88 0%, #fff 70%);
  filter: blur(56px);
  z-index: 0;
  pointer-events: none;
}

body {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ---- CARD ---- */
.container {
  background: #fff;
  border-radius: 22px;
  box-shadow: 0 4px 32px #e4eafd1a, 0 1px 7px #b1bcff1a;
  border: 1.3px solid #e9eef6;
  padding: 21px 12px 19px 12px;
  width: 96vw;
  max-width: 410px;
  margin: 2.1rem auto 1.8rem auto;
  position: relative;
  text-align: center;
  animation: fadeIn .38s;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.05rem;
}

@keyframes fadeIn { from {opacity:0; transform:translateY(17px);} to {opacity:1; transform:none;} }

/* BADGE MODERNE */
.container::after {
  content: "Verified";
  display: block;
  position: absolute;
  top: 18px; right: 18px;
  background: linear-gradient(90deg, #eef5ff 10%, #e6f2fe 100%);
  color: #000000;
  font-size: 0.77rem;
  font-weight: 700;
  padding: 5px 13px;
  border-radius: 14px;
  box-shadow: 0 1px 6px #b6c9fd33;
  letter-spacing: 0.01em;
}

/* ---- TITRE ---- */
h1 {
  font-size: 1.18rem;
  font-weight: 900;
  color: #253059;
  letter-spacing: -0.3px;
  margin: 0 0 6px 0;
  line-height: 1.13;
  width: 100%;
  word-break: break-word;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5em;
}

/* Favori (coeur) */
.favorite-btn {
  font-size: 1.12rem;
  background: none;
  border: none;
  margin-left: 0.5em;
  color: #de3358;
  cursor: pointer;
  transition: transform 0.13s;
}
.favorite-btn:active { transform: scale(1.1); }

/* ---- IMAGE ---- */
img {
  width: 88vw;
  max-width: 330px;
  height: 110px;
  object-fit: contain;
  border-radius: 13px;
  margin: 0 auto 0.2rem auto;
  background: #f4f6fb;
  box-shadow: 0 2px 11px #e7eefd13;
  display: block;
}

strong {
  color: #000000;
  font-weight: 800;
  letter-spacing: 0.01em;
  font-size: 1.03em;
}

/* Montant / cr√©ateur */
p {
  font-size: 1.01rem;
  margin: 0.30em 0 0.30em 0;
  color: #374166;
  font-weight: 600;
}

.meta {
  font-size: .97rem;
  color: #a7abc8;
  font-weight: 700;
  margin-top: 0;
  margin-bottom: 1em;
}

.actions {
  margin-top: 0.3rem;
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  width: 100%;
}

button, .actions button {
  background: linear-gradient(90deg, #eef2fd 10%, #e6f2fe 100%);
  color: #3551ad;
  border: none;
  border-radius: 15px;
  font-size: 1rem;
  font-weight: 700;
  padding: 11px 18px;
  box-shadow: 0 1px 7px #d4e0fa16;
  transition: background 0.13s, color 0.13s, transform 0.13s, box-shadow 0.12s;
  cursor: pointer;
  outline: none;
  margin: 0;
  min-width: 0;
  min-height: 0;
  display: inline-flex;
  align-items: center;
  gap: 0.2em;
}
button:hover {
  background: linear-gradient(90deg,#f4f6fc 10%,#dde4fc 100%);
  color: #223179;
  box-shadow: 0 0 13px #dde2f733;
  transform: translateY(-1px) scale(1.03);
}
.actions button {
  font-size: .97rem;
  padding: 9px 14px;
}

input[type="number"], textarea {
  width: 100%;
  padding: 10px 12px;
  border: 1.2px solid #e4e8ef;
  border-radius: 10px;
  background: #f8fafd;
  font-size: 1rem;
  color: #000000;
  margin-bottom: 8px;
  margin-top: 6px;
  outline: none;
  transition: border 0.14s;
  font-family: inherit;
  box-sizing: border-box;
  resize: vertical;
  min-height: 32px;
}
input[type="number"]:focus, textarea:focus {
  border: 1.5px solid #b1b7c8;
  background: #f3f6fa;
}
label {
  display: block;
  margin-bottom: 5px;
  margin-top: 10px;
  font-size: 0.98rem;
  color: #253059;
  font-weight: 700;
  text-align: left;
}
#message-popup {
  margin-top: 0.6rem;
  background: #f7f9fb;
  border-radius: 10px;
  box-shadow: 0 1px 4px #dde3f622;
  padding: 12px 7px 8px 7px;
  animation: fadeIn .13s;
}
#message-content {
  min-height: 38px;
}
#message-status, #offer-message {
  margin-top: 6px;
  font-weight: 700;
  font-size: 0.97rem;
  color: #4ea07d;
}
a {
  color: #000000;
  font-size: 1rem;
  text-decoration: none;
  transition: color .13s;
  display: inline-block;
  margin: 1.2em auto 0 auto;
}
a:hover {
  color: #223179;
  text-decoration: underline;
}

/* ---- Bouton retour mobile flottant am√©lior√© ---- */
a.back-btn {
  display: flex;
  align-items: center;
  gap: 0.38em;
  margin: 0 auto;
  padding: 10px 19px 10px 12px;
  background: linear-gradient(90deg,#f4f6fc 10%,#dde4fc 100%);
  color: #000000;
  font-size: 1.01rem;
  font-weight: 800;
  border: none;
  border-radius: 15px;
  box-shadow: 0 2px 7px #dde3f624;
  text-decoration: none;
  transition: background 0.13s, color 0.12s, transform 0.11s, box-shadow 0.12s;
  position: fixed;
  left: 50%;
  bottom: 20px;
  transform: translateX(-50%);
  z-index: 9;
  border: 1px solid #e4e8ef;
}
a.back-btn:hover {
  background: linear-gradient(90deg,#eaeef6 0%,#e3eafe 100%);
  color: #141826;
  box-shadow: 0 0 13px #c2d3f233;
  transform: translateX(-50%) translateY(-2px) scale(1.04);
  text-decoration: underline;
}
a.back-btn:active {
  transform: translateX(-50%) scale(0.98);
}
a.back-btn svg {
  width: 15px;
  height: 15px;
  margin-right: 2px;
  vertical-align: middle;
  fill: none;
  stroke: #506ad4;
  stroke-width: 2.1;
}

/* --------- Desktop --------- */
@media (min-width: 650px) {
  .container {
    border-radius: 28px;
    padding: 32px 36px 22px 36px;
    max-width: 420px;
    margin: 3.4rem auto 2.3rem auto;
    gap: 1.1rem;
  }
  h1 {
    font-size: 1.36rem;
    margin-bottom: 1.2rem;
  }
  img {
    height: 130px;
    border-radius: 13px;
    margin-bottom: 0.7rem;
  }
  button, .favorite-btn {
    font-size: 1.07rem;
    border-radius: 15px;
    padding: 12px 17px;
  }
  .favorite-btn { font-size: 1.25rem; }
  a.back-btn {
    font-size: 1.09rem;
    border-radius: 17px;
    padding: 12px 26px 12px 20px;
    bottom: 32px;
  }
  a.back-btn svg {
    width: 19px;
    height: 19px;
  }
}


    </style>
  </head>
  <body>
    {{#if notFound}}
      <p>Projet introuvable.</p>
    {{else if accessDenied}}
      <p>Acc√®s refus√©.</p>
    {{else}}
      <div class="container">
        <h1>
          {{project.file}}
          <button id="favorite-btn" class="favorite-btn" onclick="toggleFavorite(event, {{project.id}})">
            {{#if isFavorite}}‚ù§Ô∏è{{else}}ü§ç{{/if}}
          </button>
        </h1>

        {{#if project.imageurl}}
          <img src="{{project.imageurl}}" alt="Image du projet" />
        {{/if}}

        <p><strong>Montant demand√© :</strong> {{project.amount}} ‚Ç¨</p>
        <p><strong>Cr√©√© par :</strong> {{project.ownerName}}</p>

        {{#unless isOwner}}
          <button onclick="toggleMessageForm()">‚úâÔ∏è Contacter le cr√©ateur</button>

          <div id="message-popup" style="display: none;">
            <textarea id="message-content" placeholder="Votre message..."></textarea>
            <button onclick="sendMessage({{project.id}})">Envoyer</button>
            <p id="message-status"></p>
          </div>
        {{/unless}}

        {{#if isOwner}}
          <div class="actions">
            <form method="POST" action="/pitch-deck/{{project.id}}/delete">
              <button type="submit">üóëÔ∏è Supprimer</button>
            </form>
            <form method="GET" action="/pitch-deck/{{project.id}}/edit">
              <button type="submit">‚úèÔ∏è Modifier</button>
            </form>
          </div>
        {{else}}
          {{#if (eq user.role "investor")}}
            <div class="actions">
              <form id="offer-form">
                <label for="amount">Faire une offre üí∞ (‚Ç¨)</label>
                <input type="number" name="amount" id="offer-amount" required min="1" step="any" />
                <button type="submit">Proposer</button>
              </form>
              <p id="offer-message" style="color: #35a06d;"></p>
            </div>
          {{/if}}
        {{/if}}
      </div>
    {{/if}}

    <a href="/accueil" class="back-btn">
      <svg viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
      Retour
    </a>

    <script>
      async function toggleFavorite(event, pitchdeckId) {
        event.preventDefault();
        const res = await fetch(`/favorites/toggle/${pitchdeckId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });

        if (res.ok) {
          const { favorited } = await res.json();
          const btn = document.getElementById('favorite-btn');
          if (btn) btn.textContent = favorited ? '‚ù§Ô∏è' : 'ü§ç';
        } else {
          alert("Erreur lors de l'ajout/suppression du favori.");
        }
      }

      const offerForm = document.getElementById('offer-form');
      if (offerForm) {
        offerForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const amount = document.getElementById('offer-amount').value;
          const pitchdeckId = {{project.id}};

          const res = await fetch(`/projets/${pitchdeckId}/offre`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ amount: parseFloat(amount) }),
          });

          const msg = document.getElementById('offer-message');
          if (res.ok) {
            msg.textContent = '‚úÖ Offre envoy√©e avec succ√®s !';
          } else {
            msg.textContent = '‚ùå Une erreur est survenue.';
          }
        });
      }

      function toggleMessageForm() {
        const popup = document.getElementById("message-popup");
        popup.style.display = popup.style.display === "none" ? "block" : "none";
      }

      async function sendMessage(projectId) {
        const content = document.getElementById("message-content").value;
        const status = document.getElementById("message-status");

        const res = await fetch(`/projets/${projectId}/message`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content }),
        });

        if (res.ok) {
          status.textContent = "‚úÖ Message envoy√© !";
        } else {
          status.textContent = "‚ùå Erreur lors de l'envoi.";
        }
      }
    </script>
  </body>
</html>
